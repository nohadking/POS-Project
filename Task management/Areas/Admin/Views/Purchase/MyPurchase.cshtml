@using Infarstuructre.BL
@model ViewmMODeElMASTER;
@inject UserManager<ApplicationUser> userManager
@{
    ViewData["Title"] = "MyPurchase";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

@{
    var user = await userManager.GetUserAsync(User);
}

<div hidden id="UserName">@user.UserName</div>

<div class="page-wrapper">
    <div class="content">
        <div class="page-header transfer">
            <div class="add-item d-flex">
                <div class="page-title">
                    <h4>Purchase List</h4>
                    <h6>Manage your purchases</h6>
                </div>
            </div>
            <ul class="table-top-head">
                <li>
                    <a data-bs-toggle="tooltip" data-bs-placement="top" title="Pdf">
                        <img src="~/AdminEn/assets/img/icons/pdf.svg" alt="img">
                    </a>
                </li>
                <li>
                    <a data-bs-toggle="tooltip" data-bs-placement="top" title="Excel">
                        <img src="~/AdminEn/assets/img/icons/excel.svg" alt="img">
                    </a>
                </li>
                <li>
                    <a data-bs-toggle="tooltip" data-bs-placement="top" title="print">
                        <img src="~/AdminEn/assets/img/icons/printer.svg" alt="img">
                    </a>
                </li>
                <li>
                    <a data-bs-toggle="tooltip" data-bs-placement="top" title="Refresh">
                        <i data-feather="rotate-ccw" class="feather-rotate-ccw"></i>
                    </a>
                </li>
                <li>
                    <a data-bs-toggle="tooltip" data-bs-placement="top" title="Collapse" id="collapse-header"><i data-feather="chevron-up" class="feather-chevron-up"></i></a>
                </li>
            </ul>
            <div class="d-flex purchase-pg-btn">
                <div class="page-btn">
                    <a href="#" class="btn btn-added" data-bs-toggle="modal" data-bs-target="#add-units">
                        <i data-feather="plus-circle" class="me-2"></i>Add New Purchase
                    </a>
                </div>
                <div class="page-btn import">
                    <a href="#" class="btn btn-added color" data-bs-toggle="modal" data-bs-target="#view-notes">
                        <i data-feather="download" class="me-2"></i>Import Purchase
                    </a>
                </div>
            </div>

        </div>

        <!-- /product list -->
        <div class="card table-list-card">
            <div class="card-body">
                <div class="table-top">
                    <div class="search-set">
                        <div class="search-input">
                            <a href="" class="btn btn-searchset">
                                <i data-feather="search"
                                   class="feather-search"></i>
                            </a>
                        </div>
                    </div>
                    <div class="search-path">
                        <a class="btn btn-filter" id="filter_search">
                            <i data-feather="filter" class="filter-icon"></i>
                            <span><img src="~/AdminEn/assets/img/icons/closes.svg" alt="img"></span>
                        </a>
                    </div>
                    <div class="form-sort">
                        <i data-feather="sliders" class="info-img"></i>
                        <select class="select">
                            <option>Sort by Date</option>
                            <option>Newest</option>
                            <option>Oldest</option>
                        </select>
                    </div>
                </div>
                <!-- /Filter -->
                <div class="card" id="filter_inputs">
                    <div class="card-body pb-0">
                        <div class="row">
                            <div class="col-lg-2 col-sm-6 col-12">
                                <div class="input-blocks">
                                    <i data-feather="user" class="info-img"></i>
                                    <select class="select">
                                        <option>Choose Supplier Name</option>
                                        <option>Apex Computers</option>
                                        <option>Beats Headphones</option>
                                        <option>Dazzle Shoes</option>
                                        <option>Best Accessories</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-2 col-sm-6 col-12">
                                <div class="input-blocks">
                                    <i data-feather="stop-circle" class="info-img"></i>
                                    <select class="select">
                                        <option>Choose Status</option>
                                        <option>Received</option>
                                        <option>Ordered</option>
                                        <option>Pending</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-2 col-sm-6 col-12">
                                <div class="input-blocks">
                                    <i data-feather="file" class="info-img"></i>
                                    <select class="select">
                                        <option>Enter Reference</option>
                                        <option>PT001</option>
                                        <option>PT002</option>
                                        <option>PT003</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-2 col-sm-6 col-12">
                                <div class="input-blocks">
                                    <i class="fas fa-money-bill info-img"></i>
                                    <select class="select">
                                        <option>Choose Payment Status</option>
                                        <option>Paid</option>
                                        <option>Partial</option>
                                        <option>Unpaid</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6 col-12 ms-auto">
                                <div class="input-blocks">
                                    <a class="btn btn-filters ms-auto">
                                        <i data-feather="search"
                                           class="feather-search"></i> Search
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Filter -->
                <div class="table-responsive product-list">
                    <table class="table  datanew list">
                        <thead>
                            <tr>
                                <th class="no-sort">
                                    <label class="checkboxs">
                                        <input type="checkbox" id="select-all">
                                        <span class="checkmarks"></span>
                                    </label>
                                </th>
                                <th>@ResourceWeb.lbSupplierName</th>
                                <th>@ResourceWeb.lbPurchaseDate</th>
                                <th>@ResourceWeb.lbPaymentMethodAr</th>

                                <th>@ResourceWeb.LBPurchaseNumber</th>
                                <th>@ResourceWeb.LBPurchaseSubNumber</th>
                                <th>@ResourceWeb.LBTotalQuantity</th>
                                <th>@ResourceWeb.LBTotalDiscount</th>
                                <th>@ResourceWeb.LBshipping</th>
                                <th>@ResourceWeb.LBTotalAll</th>
                                <th>@ResourceWeb.LbDateTimeEntry</th>
                                <th>@ResourceWeb.LbDataEntry</th>
                                <th>@ResourceWeb.lbCurrentState</th>
                                <th class="no-sort">@ResourceWeb.LbOpration</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.ListViewPurchase)
                            {
                                <tr>
                                    <td>
                                        <label class="checkboxs">
                                            <input type="checkbox">
                                            <span class="checkmarks"></span>
                                        </label>
                                    </td>
                                    <td>
                                        <div class="userimgname">
                                            <a href="#" class="userslist-img bg-img">
                                                <img src="@string.Format("/Images/Home/{0}", item.PhotoSupplier)" alt="product">
                                            </a>
                                            <div>
                                                <a href="#">@item.SupplierName</a>
                                            </div>
                                        </div>
                                    </td>
                                    <td>@item.PurchaseDate</td>
                                    <td>@item.PaymentMethodAr</td>
                                    <td>@item.PurchaseNumber</td>
                                    <td>@item.PurchaseSubNumber</td>
                                    <td>@item.TotalQuantity</td>
                                    <td>@item.TotalDiscount</td>
                                    <td>@item.shipping</td>
                                    <td>@item.TotalAll</td>
                                    <td>@item.DateTimeEntry</td>
                                    <td>@item.DataEntry</td>
                                    <td>@item.CurrentState</td>
                                    <td class="action-table-data">
                                        <div class="edit-delete-action">
                                            <a class="me-2 p-2" href="javascript:void(0);">
                                                <i data-feather="eye" class="action-eye"></i>
                                            </a>
                                            <a class="me-2 p-2" data-bs-toggle="modal" data-bs-target="#edit-units">
                                                <i data-feather="edit" class="feather-edit"></i>
                                            </a>
                                            <a class="confirm-text p-2" href="javascript:void(0);">
                                                <i data-feather="trash-2" class="feather-trash-2"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
        <!-- /product list -->
    </div>
</div>













@*
/////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////// *@
<!-- /Main Wrapper -->
<!-- Add Purchase -->
<div class="modal fade" id="add-units">
    <div class="modal-dialog purchase modal-dialog-centered stock-adjust-modal">
        <div class="modal-content">
            <div class="page-wrapper-new p-0">
                <div class="content">
                    <div class="modal-header border-0 custom-modal-header">
                        <div class="page-title">
                            <h4>إضافة سند شراء</h4>
                        </div>
                        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body custom-modal-body">
                        <form action="purchase-list.html">
                            <div class="row">
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                    <div class="input-blocks add-product">
                                        <label>@ResourceWeb.lbSupplierName</label>
                                        <div class="row">
                                            <div class="col-lg-10 col-sm-10 col-10">
                                                <select class="form-select" asp-for="@Model.Purchase.IdSupplier" asp-items="@(new SelectList(ViewBag.Supplier, "IdSupplier", "SupplierName"))" id="supplierSelect">
                                                    <option>اختر المورد</option>
                                                </select>
                                            </div>
                                            <div class="col-lg-2 col-sm-2 col-2 ps-0">

                                                <img id="supplierImage" src="" alt="Supplier Image" class="img-fluid" style="max-width: 50px; display: none;" />

                                            </div>
                                        </div>

                                    </div>

                                </div>
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                    <div class="input-blocks">
                                        <label>@ResourceWeb.lbPurchaseDate</label>
                                        <div class="input-groupicon calender-input">
                                            <input id="PurcheasDt" type="date" class="form-control" placeholder="Choose">
                                        </div>
                                    </div>
                                </div>
                                    <div class="col-lg-4 col-md-6 col-sm-12">
                                    <div class="input-blocks">
                                        <label>بيان الطلب</label>
                                        <div class="input-groupicon calender-input">
                                            <input id="purStatment" type="text" class="form-control">
                                        </div>
                                    </div>
                               
                                </div>
                            </div>
                                <div class="row">
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                    <div class="input-blocks">
                                        <label>@ResourceWeb.lbPaymentMethodAr</label>
                                        <select id="PayMethId" class="form-select" asp-for="@Model.Purchase.IdPaymentMethod" asp-items="@(new SelectList(ViewBag.PaymentMethod, "IdPaymentMethod", "PaymentMethodAr"))">
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                    <div class="input-blocks">
                                        <label>@ResourceWeb.LBPurchaseNumber</label>
                                        <input id="PurcheasNu" type="text" class="form-control" value="@ViewBag.nomberMax">
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                    <div class="input-blocks">
                                        <label>@ResourceWeb.LBPurchaseSubNumber</label>
                                        <input id="PurcheasSubNu" type="text" class="form-control">
                                    </div>
                                </div>
                            </div>
                           
                            <div class="row">
                                <div class="col-lg-7">
                                    <div class="input-blocks">
                                        <label>المنتجات</label>

                                        <select id="productSelect" class="form-select" asp-for="@Model.Purchase.IdProduct">
                                            <option>اختر منتج</option>
                                            @{
                                                var Cards = (@ViewBag.ClassCard as List<TBViewClassCard>);
                                            }
                                            @if (Cards != null && Cards.Any())
                                            {
                                                foreach (var item in Cards)
                                                {
                                                    <option value="@item.IdClassCard" data-additional="@item.Photo">
                                                        @item.ItemName
                                                    </option>
                                                }
                                            }
                                            else
                                            {
                                                <option disabled>لا توجد منتجات متاحة</option>
                                            }
                                        </select>


                                    </div>
                                </div>
                                <div class="col-lg-2">
                                    <div class="input-blocks">
                                        <label>أخر سعر شراء</label>
                                        <input type="text" id="lastPurchasePrice" class="form-control" readonly>
                                    </div>
                                </div>

                                <div class="col-lg-3">

                                    <label>إضافة منتج </label>
                                    <div class="add-icon tab">
                                        <a onclick="AddProductToTBL()" href="javascript:void(0);"><i data-feather="plus-circle" class="feather-plus-circles"></i></a>
                                    </div>
                                </div>
                                <div class="col-lg-12">
                                    <div class="modal-body-table">
                                        <div class="table-responsive">
                                            <table class="table  datanew">
                                                <thead>
                                                    <tr>
                                                        <th>المنتج</th>
                                                        <th>الكمية</th>
                                                        <th>الوحدة</th>
                                                        <th>الكمية المجانية</th>
                                                        <th>السعر الافرادي($)</th>
                                                        <th>الخصم($)</th>
                                                        <th>الضريبة(%)</th>
                                                        <th>إجمالي الكمية($)</th>
                                                        <th>أجمالي السعر($)</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="TBLToAddPurcheas">
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-3 col-md-6 col-sm-12">
                                        <div class="input-blocks">
                                            <label>Order Tax</label>
                                            <input id="OrderTotalTax" type="text">
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6 col-sm-12">
                                        <div class="input-blocks">
                                            <label>Discount</label>
                                            <input id="OrderTotalDiscount" type="text">
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6 col-sm-12">
                                        <div class="input-blocks">
                                            <label>Total Quantity</label>
                                            <input id="OrderTotalQTY" type="text">
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6 col-sm-12">
                                        <div class="input-blocks">
                                            <label>Shipping</label>
                                            <input id="OrderTotalShipping" type="text">
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6 col-sm-12">
                                        <div class="input-blocks">
                                            <label>Order Total Price</label>
                                            <input id="OrderTotalPrice" type="text">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-12">
                                <div class="input-blocks summer-description-box">
                                    <label>Notes</label>
                                    <input id="NotesForPurcheas" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="modal-footer-btn">
                                    <button type="button" class="btn btn-cancel me-2" data-bs-dismiss="modal">Cancel</button>
                                    <button onclick="SavePurcheasInDB()" type="button" class="btn btn-submit">Submit</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@*
/////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////// *@



<!-- /Add Purchase -->
<!-- Edit Purchase -->
<div class="modal fade" id="edit-units">
    <div class="modal-dialog purchase modal-dialog-centered stock-adjust-modal">
        <div class="modal-content">
            <div class="page-wrapper-new p-0">
                <div class="content">
                    <div class="modal-header border-0 custom-modal-header">
                        <div class="page-title">
                            <h4>Edit Purchase</h4>
                        </div>
                        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body custom-modal-body">
                        <form action="purchase-list.html">
                            <div>
                                <div class="row">
                                    <div class="col-lg-3 col-sm-6 col-12">
                                        <div class="input-blocks">
                                            <label>Supplier Name</label>
                                            <div class="row">
                                                <div class="col-lg-10 col-sm-10 col-10">
                                                    <select class="select">
                                                        <option>Dazzle Shoes</option>
                                                        <option>Apex Computers</option>
                                                        <option>Beats Headphones</option>
                                                    </select>
                                                </div>
                                                <div class="col-lg-2 col-sm-2 col-2 ps-0">
                                                    <div class="add-icon tab">
                                                        <a href="javascript:void(0);"><i data-feather="plus-circle" class="feather-plus-circles"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-sm-6 col-12">
                                        <div class="input-blocks">
                                            <label>Purchase Date </label>
                                            <div class="input-groupicon">
                                                <input type="text" placeholder="19 Jan 2023" class="datetimepicker">
                                                <div class="addonset">
                                                    <img src="~/AdminEn/assets/img/icons/calendars.svg" alt="img">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-sm-6 col-12">
                                        <div class="input-blocks">
                                            <label>Product Name</label>
                                            <select class="select">
                                                <option>Nike Jordan</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-sm-6 col-12">
                                        <div class="input-blocks">
                                            <label>Reference No.</label>
                                            <input type="text" value="010203">
                                        </div>
                                    </div>
                                    <div class="col-lg-12 col-sm-6 col-12">
                                        <div class="input-blocks">
                                            <label>Product</label>
                                            <div class="input-groupicon">
                                                <input type="text"
                                                       placeholder="Scan/Search Product by code and select">
                                                <div class="addonset">
                                                    <img src="~/AdminEn/assets/img/icons/scanners.svg" alt="img">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="modal-body-table">
                                            <div class="table-responsive">
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>Product Name</th>
                                                            <th>QTY</th>
                                                            <th>Purchase Price($) </th>
                                                            <th>Discount($) </th>
                                                            <th>Tax %</th>
                                                            <th>Tax Amount($)</th>
                                                            <th class="text-end">Unit Cost($)</th>
                                                            <th class="text-end">Total Cost ($) </th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                <div class="productimgname">
                                                                    <a href="javascript:void(0);" class="product-img stock-img">
                                                                        <img src="~/AdminEn/assets/img/products/stock-img-02.png" alt="product">
                                                                    </a>
                                                                    <a href="javascript:void(0);">Nike Jordan</a>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="product-quantity">
                                                                    <span class="quantity-btn">+<i data-feather="plus-circle" class="plus-circle"></i></span>
                                                                    <input type="text" class="quntity-input" value="10">
                                                                    <span class="quantity-btn"><i data-feather="minus-circle" class="feather-search"></i></span>
                                                                </div>
                                                            </td>
                                                            <td>2000</td>
                                                            <td>500.00</td>
                                                            <td>0.00</td>
                                                            <td>0.00</td>
                                                            <td>0.00</td>
                                                            <td>1500</td>
                                                            <td>
                                                                <a class="delete-set">
                                                                    <img src="~/AdminEn/assets/img/icons/delete.svg" alt="svg">
                                                                </a>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12 float-md-right">
                                        <div class="total-order">
                                            <ul>
                                                <li>
                                                    <h4>Order Tax</h4>
                                                    <h5>$ 0.00</h5>
                                                </li>
                                                <li>
                                                    <h4>Discount</h4>
                                                    <h5>$ 0.00</h5>
                                                </li>
                                                <li>
                                                    <h4>Shipping</h4>
                                                    <h5>$ 0.00</h5>
                                                </li>
                                                <li class="total">
                                                    <h4>Grand Total</h4>
                                                    <h5>$1500.00</h5>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-3 col-sm-6 col-12">
                                        <div class="input-blocks">
                                            <label>Order Tax</label>
                                            <input type="text" value="0">
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-sm-6 col-12">
                                        <div class="input-blocks">
                                            <label>Discount</label>
                                            <input type="text" value="0">
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-sm-6 col-12">
                                        <div class="input-blocks">
                                            <label>Shipping</label>
                                            <input type="text" value="0">
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-sm-6 col-12">
                                        <div class="input-blocks">
                                            <label>Status</label>
                                            <select class="select">
                                                <option>Sent</option>
                                                <option>Ordered</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-12">
                                <div class="input-blocks summer-description-box">
                                    <label>Description</label>
                                    <div id="summernote2">
                                        <p>These shoes are made with the highest quality materials. </p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="modal-footer-btn">
                                    <button type="button" class="btn btn-cancel me-2" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-submit">Save Changes</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /Edit Purchase -->
<!-- Import Purchase -->
<div class="modal fade" id="view-notes">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="page-wrapper-new p-0">
                <div class="content">
                    <div class="modal-header border-0 custom-modal-header">
                        <div class="page-title">
                            <h4>Import Purchase</h4>
                        </div>
                        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body custom-modal-body">
                        <form action="purchase-list.html">
                            <div class="row">
                                <div class="col-lg-6 col-sm-6 col-12">
                                    <div class="input-blocks">
                                        <label>Supplier Name</label>
                                        <div class="row">
                                            <div class="col-lg-10 col-sm-10 col-10">
                                                <select class="select">
                                                    <option>Choose</option>
                                                    <option>Apex Computers</option>
                                                    <option>Apex Computers</option>
                                                </select>
                                            </div>
                                            <div class="col-lg-2 col-sm-2 col-2 ps-0">
                                                <div class="add-icon tab">
                                                    <a href="javascript:void(0);"><i data-feather="plus-circle" class="feather-plus-circles"></i></a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-sm-6 col-12">
                                    <div class="input-blocks">
                                        <label>Purchase Status </label>
                                        <select class="select">
                                            <option>Choose</option>
                                            <option>Received</option>
                                            <option>Ordered</option>
                                            <option>Pending</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-12 col-sm-6 col-12">
                                    <div class="row">
                                        <div>
                                            <!-- <div class="input-blocks download">
                                                <a class="btn btn-submit">Download Sample File</a>
                                            </div> -->
                                            <div class="modal-footer-btn download-file">
                                                <a href="javascript:void(0)" class="btn btn-submit">Download Sample File</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-12">
                                    <div class="input-blocks image-upload-down">
                                        <label>	Upload CSV File</label>
                                        <div class="image-upload download">
                                            <input type="file">
                                            <div class="image-uploads">
                                                <img src="~/AdminEn/assets/img/download-img.png" alt="img">
                                                <h4>Drag and drop a <span>file to upload</span></h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-sm-6 col-12">
                                    <div class="input-blocks">
                                        <label>Order Tax</label>
                                        <input type="text" value="0">
                                    </div>
                                </div>
                                <div class="col-lg-4 col-sm-6 col-12">
                                    <div class="input-blocks">
                                        <label>Discount</label>
                                        <input type="text" value="0">
                                    </div>
                                </div>
                                <div class="col-lg-4 col-sm-6 col-12">
                                    <div class="input-blocks">
                                        <label>Shipping</label>
                                        <input type="text" value="0">
                                    </div>
                                </div>
                            </div>
                            <div class="input-blocks summer-description-box transfer" style="margin-right">
                                <label>Description</label>
                                <div id="summernote3">
                                </div>
                                <p>Maximum 60 Characters</p>
                            </div>
                            <div class="modal-footer-btn">
                                <button type="button" class="btn btn-cancel me-2" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-submit">Submit</button>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /Import Purchase -->
<div class="customizer-links" id="setdata">
    <ul class="sticky-sidebar">
        <li class="sidebar-icons">
            <a href="#" class="navigation-add" data-bs-toggle="tooltip" data-bs-placement="left"
               data-bs-original-title="Theme">
                <i data-feather="settings" class="feather-five"></i>
            </a>
        </li>
    </ul>
</div>
@section Scripts {

    <script src="~/adminen/assets/js/purchasesting.js"></script>

    <script>
        function AddProductToTBL() {
            var productName = $('#productSelect').find("option:selected").text();
            var productId = $('#productSelect').find("option:selected").val();
            var productImg = $('#productSelect').find("option:selected").data("additional");

            console.log("productId: " + productId);
            console.log("productName: " + productName);
            console.log("productImg: " + productImg);

            var tbl = $('#TBLToAddPurcheas');
            var unitData = @Html.Raw(Json.Serialize(ViewBag.Unit));
            let options = unitData.map(unit => `<option value="${unit.idUnit}">${unit.unit}</option>`).join('');

            const row = `
                        <tr>
                            <td ><img src="/Images/Home/${productImg}" alt="${productName}" style="width: 50px; height: 50px;" /> <span class="productName">${productName}</span><span hidden class="productIId">${productId}</span></td>
                            <td><div class="product-quantity" style="margin-right:25px;">
                             <span class="quantity-btn">+<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-circle plus-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg></span>
                            <input type="text" class="quntity-input quaitity" value="0">
                            <span class="quantity-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-minus-circle feather-search"><circle cx="12" cy="12" r="10"></circle><line x1="8" y1="12" x2="16" y2="12"></line></svg></span>
                             </div>
                            </td>
                               <td>
                                <select style="width: 50px;" class="idUnitt form-control">
                                  <option>اختر</option>
                                            ${options}
                                        </select>
                                    </td>
                            <td>


                                    <div class="product-quantity">
                                 <span class="quantity-btn">+<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-circle plus-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg></span>
                                  <input type="text" class="quntity-input freeQuaitity" value="0">
                                   <span class="quantity-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-minus-circle feather-search"><circle cx="12" cy="12" r="10"></circle><line x1="8" y1="12" x2="16" y2="12"></line></svg></span>
                                  </div>
                          </td>
                            <td><input style="width: 100px;" class="form-control price" type="number" /></td>
                            <td><input style="width: 100px;" class="form-control discount" type="number" /></td>
                            <td><input style="width: 100px;" class="form-control tax" type="number" /></td>
                            <td style="width: 100px;" class="totalQty"></td>
                            <td style="width: 100px;" class="totalPrc"></td>
                        </tr>
                    `;

            tbl.append(row);
        }






        function SavePurcheasInDB() {
            var productId = $('#productSelect').find("option:selected").val();
            var supplierId = $('#supplierSelect').find("option:selected").val();
            var PayMethId = $('#PayMethId').find("option:selected").val();
            var PurcheasDt = $('#PurcheasDt').val();
            var PurcheasNu = $('#PurcheasNu').val();
            var PurcheasSubNu = $('#PurcheasSubNu').val();
            var purStatment = $('#purStatment').val();
            var UserName = $('#UserName').text();

            ///////////////////////

            var PurcheasTotalPrice = $('#OrderTotalPrice').val();
            var PurcheasTotalQTY = $('#OrderTotalQTY').val();
            var PurcheasTotalDiscount = $('#OrderTotalDiscount').val();
            var PurcheasTotalTax = $('#OrderTotalTax').val();
            var PurcheasNotes = $('#NotesForPurcheas').val();
            var OrderTotalShipping = $('#OrderTotalShipping').val();

            var dateNow = new Date();
            var day = dateNow.getDate();
            var month = dateNow.getMonth() + 1;
            var year = dateNow.getFullYear();

            var formattedDate = year + '-' + (month < 10 ? '0' + month : month) + '-' + (day < 10 ? '0' + day : day);

            $('#TBLToAddPurcheas tr').each(function (index, row) {

                var productIId = $(row).find('.productIId').text();
                var quantity = $(row).find('.quaitity').val();
                var freeQuantity = $(row).find('.freeQuaitity').val();
                var price = $(row).find('.price').val();
                var discount = $(row).find('.discount').val();
                var tax = $(row).find('.tax').val();
                var totalQty = $(row).find('.totalQty').text();
                var totalPrc = $(row).find('.totalPrc').text();
                var idUnit = $(row).find('.idUnitt').find("option:selected").val();




                var url = window.origin + '/api/PurcheasApi';
                var payLoad = {
                    "idPurchase": 0,
                    'idSupplier': parseInt(supplierId),
                    "idPaymentMethod": parseInt(PayMethId),
                    "statement": purStatment,
                    "purchaseDate": PurcheasDt,
                    "purchaseNumber": parseInt(PurcheasNu),
                    "purchaseSubNumber": parseInt(PurcheasSubNu),
                    "idProduct": parseInt(productIId),
                    "idUnit": parseInt(idUnit),
                    "quantity": parseInt(quantity),
                    "freeQuantity": parseInt(freeQuantity),
                    "allQuantity": parseInt(totalQty),
                    "singleDiscount": parseFloat(discount),
                    "purchasePrice": parseFloat(PurcheasTotalPrice),
                    "total": parseFloat(totalPrc),
                    "shipping": parseFloat(OrderTotalShipping),
                    "nouts": PurcheasNotes,
                    "totalQuantity": parseInt(PurcheasTotalQTY),
                    "totalDiscount": parseInt(PurcheasTotalDiscount),
                    "totalAll": parseFloat(PurcheasTotalPrice) - parseFloat(PurcheasTotalDiscount),
                    "dataEntry": UserName,
                    "dateTimeEntry": new Date(),
                    "currentState": true,
                };

                console.log("payLoad " + JSON.stringify(payLoad));

                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payLoad)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Data received:', data);
                    })
                    .catch(error => {
                        console.error('There was a problem with the fetch operation:', error);
                    });

            });
        }




        $(document).on('input', '.quaitity, .freeQuaitity, .price', function () {
            // تحديد الصف الحالي
            const row = $(this).closest('tr');

            // الحصول على القيم
            const quantity = parseFloat(row.find('.quaitity').val()) || 0;       // الكمية
            const freeQuantity = parseFloat(row.find('.freeQuaitity').val()) || 0; // الكمية المجانية
            const price = parseFloat(row.find('.price').val()) || 0;            // السعر الفردي

            // حساب الكمية الإجمالية
            const totalQuantity = quantity + freeQuantity;

            // حساب السعر الإجمالي
            const totalPrice = quantity * price;

            // وضع النتائج في الأعمدة المناسبة
            row.find('.totalQty').text(totalQuantity.toFixed(0)); // عرض الكمية الإجمالية كعدد صحيح
            row.find('.totalPrc').text(totalPrice.toFixed(2));    // عرض السعر الإجمالي مع منزلتين عشريتين
        });




        $(document).on('change', '#TBLToAddPurcheas', function () {
            // متغيرات لتخزين المجموعات
            let totalTax = 0;
            let totalDiscount = 0;
            let totalQty = 0;
            let totalPrice = 0;

            $('#TBLToAddPurcheas tr').each(function () {
                const row = $(this);

                // الحصول على القيم من الأعمدة
                const qty = parseFloat(row.find('.quaitity').val()) || 0;
                const freeQty = parseFloat(row.find('.freeQuaitity').val()) || 0;
                const price = parseFloat(row.find('.price').val()) || 0;
                const discount = parseFloat(row.find('.discount').val()) || 0;
                const tax = parseFloat(row.find('.tax').val()) || 0;

                // حساب الكمية الإجمالية
                const totalRowQty = qty + freeQty;

                // حساب السعر الإجمالي للصف (قبل الخصم والضرائب)
                const totalRowPrice = qty * price - discount + tax;

                // تحديث المجموعات
                totalQty += totalRowQty;
                totalDiscount += discount;
                totalTax += tax;
                totalPrice += totalRowPrice;
            });

            // تحديث القيم في الحقول أو المتغيرات
            $('#OrderTotalTax').val(totalTax.toFixed(2));
            $('#OrderTotalDiscount').val(totalDiscount.toFixed(2));
            $('#OrderTotalQTY').val(totalQty.toFixed(0));
            $('#OrderTotalPrice').val(totalPrice.toFixed(2));
        });





    </script>
}